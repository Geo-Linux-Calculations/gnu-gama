#!/bin/bash
#
# $Id: build-gamalib-Makefile-expat,v 1.2 2002/04/02 21:39:00 cepek Exp $
# 
if pwd | grep /script$; then cd ..; fi
export SCRIPTS=`pwd`/scripts


if [ ! -d expat ]
then
    echo 
    echo
    echo Current working directory is $(pwd)
    echo Directory ./expat is missing in the current working directory
    echo
    echo GaMaLib depends on expat XML parser!
    echo
    echo "Expat parser is copyrighted by James Clark (Mozilla Public License v. 1.1)"
    echo You can download expat parser from 
    echo
    echo -e "\t" ftp://ftp.jclark.com/pub/xml/expat.zip
    echo
    echo or you can dowload a copy of expat.zip from GaMaLib archive
    echo
    echo -e "\t" http://gama.fsv.cvut.cz/gama/archive/expat
    echo
    echo
    exit 1
fi

if [ ! -d gamaprog/linux ]
then
   mkdir  gamaprog/linux
fi
if [ ! -d gamaprog/linux/lib ]
then
   mkdir gamaprog/linux/lib
fi
cd gamaprog/linux/lib


echo 
echo Creating Makefile-expat for GaMaLib
echo 


# expat path relative to gamaprog/lib

EXPATPATH=../../../expat
EXPATCFLAGS="-O2 -I$EXPATPATH/xmltok -I$EXPATPATH/xmlparse -DXML_NS"

if [ ! -z "$1" ]; then EXPATCFLAGS="$EXPATCFLAGS $1"; fi  
if [ ! -z "$2" ]; then EXPATCFLAGS="$EXPATCFLAGS $2"; fi  
if [ ! -z "$3" ]; then EXPATCFLAGS="$EXPATCFLAGS $3"; fi  
if [ ! -z "$4" ]; then EXPATCFLAGS="$EXPATCFLAGS $4"; fi  
if [ ! -z "$5" ]; then EXPATCFLAGS="$EXPATCFLAGS $5"; fi  
if [ ! -z "$6" ]; then EXPATCFLAGS="$EXPATCFLAGS $6"; fi  
if [ ! -z "$7" ]; then EXPATCFLAGS="$EXPATCFLAGS $7"; fi  
if [ ! -z "$8" ]; then EXPATCFLAGS="$EXPATCFLAGS $8"; fi  
if [ ! -z "$9" ]; then EXPATCFLAGS="$EXPATCFLAGS $9"; fi  

# neprekladam xmlwf/xmlwf.c /xmlwf/xmlfile.c
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmltok/xmltok.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmltok/xmlrole.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmlwf/codepage.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmlparse/xmlparse.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmlparse/hashtable.c" 

# --------------------------------------------------------------

rm -f Makefile-expat.pro

echo "# GaMaLib Makefile-expat.pro generated by $0" >> Makefile-expat.pro
echo "# on" $(date) "by" $(whoami)                  >> Makefile-expat.pro
echo "#"                                            >> Makefile-expat.pro
echo                                                >> Makefile-expat.pro
cat   $SCRIPTS/platforms.defs                       >> Makefile-expat.pro
echo                                                >> Makefile-expat.pro
echo CFLAGS=$EXPATCFLAGS                            >> Makefile-expat.pro
echo LIBR=@ar -r gamalib.a                          >> Makefile-expat.pro
echo SRC=../../../                                  >> Makefile-expat.pro
echo OBJDIR=                                        >> Makefile-expat.pro
echo                                                >> Makefile-expat.pro
echo "ALL : gamalib.a"                              >> Makefile-expat.pro
echo                                                >> Makefile-expat.pro


for i in $EXPATCFILES
do  
    NAME=$(echo "$i" | sed s/".*\/"// | sed s/\.c$//)
    echo adding rule for $i	
    OBJECTS="$OBJECTS $NAME.\$(OBJ)"
    PNAME=$(echo "$i" | sed s=../../../="\$(SRC)"=g )
    echo "\$(OBJDIR)$NAME.\$(OBJ) :" $PNAME   >> Makefile-expat.pro
    echo -e "\\t\$(CC) \$(CFLAGS) -c" $PNAME  >> Makefile-expat.pro
    echo -e "\\t\$(LIBR) $NAME.\$(OBJ)"       >> Makefile-expat.pro    
    echo                                      >> Makefile-expat.pro  
done

echo

echo                           >> Makefile-expat.pro
echo    "gamalib.a :$OBJECTS"  >> Makefile-expat.pro
echo -e "\\tranlib gamalib.a"  >> Makefile-expat.pro
echo -e "\\ttouch  gamalib.a"  >> Makefile-expat.pro
echo                           >> Makefile-expat.pro 

        





