#!/bin/bash
#
# $Id: build-gamalib-Makefile-expat,v 1.1 2001/12/07 11:45:44 cepek Exp $

# Pokud jsem v podadresari ./script, prejdu o jednu uroven vys.
if pwd | grep /script$; then cd ..; fi


if [ ! -d expat ]
then
    echo 
    echo
    echo Current working directory is $(pwd)
    echo Directory ./expat is missing in the current working directory
    echo
    echo GaMaLib depends on expat XML parser!
    echo
    echo "Expat parser is copyrighted by James Clark (Mozilla Public License v. 1.1)"
    echo You can download expat parser from 
    echo
    echo -e "\t" ftp://ftp.jclark.com/pub/xml/expat.zip
    echo
    echo or you can dowload a copy of expat.zip from GaMaLib archive
    echo
    echo -e "\t" http://gama.fsv.cvut.cz/gama/archive/expat
    echo
    echo
    exit 1
fi

if [ ! -d gamaprog/linux ]
then
   mkdir  gamaprog/linux
fi
if [ ! -d gamaprog/linux/lib ]
then
   mkdir gamaprog/linux/lib
fi
cd gamaprog/linux/lib


echo 
echo Creating Makefile-expat for gamalib.a
echo 

if [ ! -z "$1" ]; then FCC="$FCC $1"; fi  
if [ ! -z "$2" ]; then FCC="$FCC $2"; fi  
if [ ! -z "$3" ]; then FCC="$FCC $3"; fi  
if [ ! -z "$4" ]; then FCC="$FCC $4"; fi  
if [ ! -z "$5" ]; then FCC="$FCC $5"; fi  
if [ ! -z "$6" ]; then FCC="$FCC $6"; fi  
if [ ! -z "$7" ]; then FCC="$FCC $7"; fi  
if [ ! -z "$8" ]; then FCC="$FCC $8"; fi  
if [ ! -z "$9" ]; then FCC="$FCC $9"; fi  

# cesta do adresare expat realtivne z gamaprog/lib

EXPATPATH=../../../expat
EXPATCFLAGS="-O2 -I$EXPATPATH/xmltok -I$EXPATPATH/xmlparse -DXML_NS"

if [ ! -z "$1" ]; then EXPATCFLAGS="$EXPATCFLAGS $1"; fi  
if [ ! -z "$2" ]; then EXPATCFLAGS="$EXPATCFLAGS $2"; fi  
if [ ! -z "$3" ]; then EXPATCFLAGS="$EXPATCFLAGS $3"; fi  
if [ ! -z "$4" ]; then EXPATCFLAGS="$EXPATCFLAGS $4"; fi  
if [ ! -z "$5" ]; then EXPATCFLAGS="$EXPATCFLAGS $5"; fi  
if [ ! -z "$6" ]; then EXPATCFLAGS="$EXPATCFLAGS $6"; fi  
if [ ! -z "$7" ]; then EXPATCFLAGS="$EXPATCFLAGS $7"; fi  
if [ ! -z "$8" ]; then EXPATCFLAGS="$EXPATCFLAGS $8"; fi  
if [ ! -z "$9" ]; then EXPATCFLAGS="$EXPATCFLAGS $9"; fi  

# neprekladam xmlwf/xmlwf.c /xmlwf/xmlfile.c
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmltok/xmltok.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmltok/xmlrole.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmlwf/codepage.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmlparse/xmlparse.c"
EXPATCFILES="$EXPATCFILES $EXPATPATH/xmlparse/hashtable.c" 

# --------------------------------------------------------------

rm -f Makefile-expat

echo "# GaMaLib Makefile-expat generated by $0" >> Makefile-expat
echo "# on" $(date) "by" $(whoami)              >> Makefile-expat
echo "#"                                        >> Makefile-expat
echo                                            >> Makefile-expat
echo CPP=g++                                    >> Makefile-expat
echo CC=gcc                                     >> Makefile-expat
echo FCC=$EXPATCFLAGS                           >> Makefile-expat
echo LIBR=@ar -r gamalib.a                      >> Makefile-expat
echo SRC=../../../                              >> Makefile-expat
echo OBJ=                                       >> Makefile-expat
echo                                            >> Makefile-expat
echo "ALL : gamalib.a"                          >> Makefile-expat
echo                                            >> Makefile-expat


for i in $EXPATCFILES
do  
    NAME=$(echo "$i" | sed s/".*\/"// | sed s/\.c$//)
    echo adding rule for $i	
    OBJECTS="$OBJECTS $NAME.o"
    PNAME=$(echo "$i" | sed s=../../../="\$(SRC)"=g )
    echo "\$(OBJ)$NAME.o :" $PNAME            >> Makefile-expat
    echo -e "\\t\$(CC) \$(FCC) -c" $PNAME     >> Makefile-expat
    echo -e "\\t\$(LIBR) $NAME.o"             >> Makefile-expat    
    echo                                      >> Makefile-expat  
done

echo

echo                           >> Makefile-expat
echo    "gamalib.a :$OBJECTS"  >> Makefile-expat
echo -e "\\tranlib gamalib.a"  >> Makefile-expat
echo -e "\\ttouch  gamalib.a"  >> Makefile-expat
echo                           >> Makefile-expat 

        





