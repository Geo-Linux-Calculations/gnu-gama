#!/bin/bash
#
# parametr prekladu pro GSO je -DGaMaOLSgso
# 
# $Id: Build_GaMa,v 1.1 2001/12/07 11:45:44 cepek Exp $

# pokud jsem v podadresari ./scripts, prejdu o jednu uroven vys
#
if pwd | grep /scripts$; then cd ..; fi

if [ ! -d expat ]
then
    scripts/build-gamalib-Makefile-expat
    exit 1
fi

( cd gamaprog/linux/lib ; rm -f gamalib.a *.o )

scripts/build-doc-html
scripts/build-gamalib-Makefile-expat
scripts/build-dictionaries
scripts/build-gamalib-Makefile $1 $2 $3 $4 $5 $6 $7 $8 $9 


#--------------------------------------------------------------------------

CC=g++
CF="-I../../.. -Wall -pedantic"

cd gamaprog/linux/gama
 
if [ $1 ] ; then CF="$CF $1"; fi
if [ $2 ] ; then CF="$CF $2"; fi
if [ $3 ] ; then CF="$CF $3"; fi
if [ $4 ] ; then CF="$CF $4"; fi
if [ $5 ] ; then CF="$CF $5"; fi
if [ $6 ] ; then CF="$CF $6"; fi
if [ $7 ] ; then CF="$CF $7"; fi
if [ $8 ] ; then CF="$CF $8"; fi
if [ $9 ] ; then CF="$CF $9"; fi


rm -f gama Makefile Makefile_* *.o

echo
echo  Creating Makefile for gamaprog/gama/gama.cpp
echo 

echo "# GaMa Makefile generated by $0"               >> Makefile
echo "# on" $(date) "by" $(whoami)                   >> Makefile
echo "#"                                             >> Makefile
echo                                                 >> Makefile
echo CPP=$CC                                         >> Makefile
echo FCC=$CF                                         >> Makefile 
echo GAMALIB=../lib/gamalib.a                        >> Makefile
echo SRC=../../../                                   >> Makefile
echo OBJ=                                            >> Makefile
echo                                                 >> Makefile
echo    "gama : gama.o \$(GAMALIB)"                  >> Makefile
echo -e "\t\$(CPP) -o gama gama.o \$(GAMALIB)\n"     >> Makefile

GAMADEP="\$(OBJ)"gama$( echo gama.cpp | ../../../scripts/gamalib_dep ../../.. )
GAMADEP="$GAMADEP $(find review -name *.h)"

echo    $GAMADEP                                     >> Makefile
echo -e "\t\$(CPP) \$(FCC) -I. -c gama.cpp\n"        >> Makefile


# -------------  make : linux -> borland  ------------------------------

echo "Converting Linux   Makefiles to Borland format ..."

cd ../..             
rm -rf bc msc
mkdir  bc bc/gama   bc/lib
mkdir  msc     msc/gama       msc/lib

sed 's/^X//' <<Borland-Makefile-EOF | cat > bc/Makefile

all:
	cd lib
	make
	cd ..\gama
	make

clean:
	cd gama
	del *.obj
	del gama.exe
	cd ..\lib
	del *.obj
	del gamalib.*

Borland-Makefile-EOF


sed -f ../scripts/make-linux2borland.sed < linux/gama/Makefile       \
                                         > bc/gama/Makefile
sed -f ../scripts/make-linux2borland.sed < linux/lib/Makefile        \
                                         > bc/lib/Makefile
sed -f ../scripts/make-linux2borland.sed < linux/lib/Makefile-expat  \
                                         > bc/lib/Makefile-expat

# . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . .

echo "           Borland Makefiles to Visual C++ format ..."

sed s/make/nmake/ < bc/Makefile        > msc/Makefile
sed -f ../scripts/make-borland2msc.sed < bc/gama/Makefile            \
                                       > msc/gama/Makefile
sed -f ../scripts/make-borland2msc.sed < bc/lib/Makefile             \
                                       > msc/lib/Makefile
sed -f ../scripts/make-borland2msc.sed < bc/lib/Makefile-expat       \
                                       > msc/lib/Makefile-expat


for i in $(find bc msc)
do
   if [ -f $i ]; then
      unix2dos $i
   fi
done

# ----------------------------------------------------------------------

echo
echo Compiling gamalib ...
echo 
( cd linux/lib ;  make )  
( cd linux/gama ; make ) 

#########








