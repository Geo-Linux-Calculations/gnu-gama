#!/bin/bash
#
# $Id: build-gamalib-Makefile,v 1.1 2001/12/07 11:45:44 cepek Exp $

# If we are in the subdirectory ./scripts, we have to go one level up
if pwd | grep /scripts$; then cd ..; fi

( cd scripts; make -f Makefile-gamalib_dep )

if [ ! -d gamaprog/linux ]
then
   mkdir  gamaprog/linux
fi
if [ ! -d gamaprog/linux/lib ]
then
   mkdir  gamaprog/linux/lib
fi
cd gamaprog/linux/lib

echo 
echo Creating Makefile for gamalib.a
echo 

FCC="-I../../.. -Wall -pedantic"
if [ ! -z "$1" ]; then FCC="$FCC $1"; fi  
if [ ! -z "$2" ]; then FCC="$FCC $2"; fi  
if [ ! -z "$3" ]; then FCC="$FCC $3"; fi  
if [ ! -z "$4" ]; then FCC="$FCC $4"; fi  
if [ ! -z "$5" ]; then FCC="$FCC $5"; fi  
if [ ! -z "$6" ]; then FCC="$FCC $6"; fi  
if [ ! -z "$7" ]; then FCC="$FCC $7"; fi  
if [ ! -z "$8" ]; then FCC="$FCC $8"; fi  
if [ ! -z "$9" ]; then FCC="$FCC $9"; fi  

for s in $(find ../../../gamalib | grep .cpp$ | grep -v \# | grep -v \~ )
do
	  CPPFILES="$CPPFILES $s";
done

rm -f Makefile

echo "# GaMaLib Makefile generated by $0" >> Makefile
echo "# on" $(date) "by" $(whoami)        >> Makefile
echo "#"                                  >> Makefile
echo                                      >> Makefile
echo CPP=g++                              >> Makefile
echo CC=gcc                               >> Makefile
echo FCC=$FCC                             >> Makefile
echo LIBR=@ar -r gamalib.a                >> Makefile
echo SRC=../../../                        >> Makefile
echo OBJ=                                 >> Makefile  
echo                                      >> Makefile
echo "ALL : gamalib.a"                    >> Makefile
echo                                      >> Makefile


for i in $CPPFILES
do
    echo adding rule for $i
    NAME=$(echo "$i" | sed s/".*\/"//g | sed s/\.cpp$// | tr "/" "_")
    OBJECTS="$OBJECTS $NAME.o"
    PNAME=$(echo "$i" | sed s=../../../="\$(SRC)"= )
    echo -ne "\$(OBJ)"$NAME                            >> Makefile
    echo  $i | ../../../scripts/gamalib_dep ../../..   >> Makefile
    echo -e  "\\t\$(CPP) \$(FCC) -c $PNAME"            >> Makefile
    echo -e  "\\t@\$(LIBR) $NAME.o"                    >> Makefile    
    echo                                               >> Makefile  
done

echo

echo                                >> Makefile
echo    "gamalib.a :$OBJECTS"       >> Makefile
echo -e "\\tmake -f Makefile-expat" >> Makefile
echo -e "\\tranlib gamalib.a"       >> Makefile
echo -e "\\ttouch  gamalib.a"       >> Makefile
echo                                >> Makefile 

        





