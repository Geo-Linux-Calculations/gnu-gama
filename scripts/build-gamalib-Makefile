#!/bin/bash
#
# $Id: build-gamalib-Makefile,v 1.2 2002/04/02 21:39:00 cepek Exp $

# If we are in the subdirectory ./scripts, we have to go one level up
if pwd | grep /scripts$; then cd ..; fi
export SCRIPTS=`pwd`/scripts


( cd scripts; make -f Makefile-gamalib_dep )

if [ ! -d gamaprog/linux ]
then
   mkdir  gamaprog/linux
fi
if [ ! -d gamaprog/linux/lib ]
then
   mkdir  gamaprog/linux/lib
fi
cd gamaprog/linux/lib

echo 
echo Creating Makefile for GaMaLib
echo 


for s in $(find ../../../gamalib | grep .cpp$ | grep -v \# | grep -v \~ )
do
	  CPPFILES="$CPPFILES $s";
done

rm -f Makefile.pro

echo "# Makefile.pro generated by $0"     >> Makefile.pro
echo "# on" $(date) "by" $(whoami)        >> Makefile.pro
echo "#"                                  >> Makefile.pro
echo                                      >> Makefile.pro
cat   $SCRIPTS/platforms.defs             >> Makefile.pro
echo                                      >> Makefile.pro
echo LIBR=@ar -r gamalib.a                >> Makefile.pro
echo SRC=../../../                        >> Makefile.pro
echo OBJDIR=                              >> Makefile.pro  
echo                                      >> Makefile.pro
echo "ALL : gamalib.a"                    >> Makefile.pro
echo                                      >> Makefile.pro


for i in $CPPFILES
do
    echo adding rule for $i
    NAME=$(echo "$i" | sed s/".*\/"//g | sed s/\.cpp$// | tr "/" "_")
    OBJECTS="$OBJECTS $NAME.\$(OBJ)"
    PNAME=$(echo "$i" | sed s=../../../="\$(SRC)"= )
    echo -ne "\$(OBJDIR)"$NAME                         >> Makefile.pro
    echo  $i | ../../../scripts/gamalib_dep ../../..   >> Makefile.pro
    echo -e  "\\t\$(CXX) \$(CXXFLAGS) -c $PNAME"       >> Makefile.pro
    echo -e  "\\t@\$(LIBR) $NAME.\$(OBJ)"              >> Makefile.pro    
    echo                                               >> Makefile.pro  
done

echo

echo                                    >> Makefile.pro
echo    "gamalib.a :$OBJECTS"           >> Makefile.pro
echo -e "\\tmake -f Makefile.pro-expat" >> Makefile.pro
echo -e "\\tranlib gamalib.a"           >> Makefile.pro
echo -e "\\ttouch  gamalib.a"           >> Makefile.pro
echo                                    >> Makefile.pro 






