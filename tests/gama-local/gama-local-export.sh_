#!/bin/sh

set -e   # exit on the first error

RES=@GAMA_RESULTS@/gama-local-export

mkdir -p $RES $RES/bug $RES/ctu

GAMA_LOCAL=@top_builddir@/src/gama-local
GAMA_LOCAL_XSD=@GAMA_XML@/gama-local.xsd

for g in @INPUT_FILES@ @BUG_FILES@ @CTU_FILES@
do
    $GAMA_LOCAL @GAMA_INPUT@/$g.gkf \
        --xml    $RES/$g-1.xml \
        --export $RES/$g-1.gkf
    $GAMA_LOCAL  $RES/$g-1.gkf \
        --xml    $RES/$g-2.xml
    src/check_xml_xml "exported $g" \
        $RES/$g-1.xml \
        $RES/$g-2.xml

if test "x@GNU_GAMA_LOCAL_TEST_XMLLINT@" = "xyes"; then
    xmllint --schema $GAMA_LOCAL_XSD \
	    $RES/$g-1.gkf --noout
fi
    echo
done
